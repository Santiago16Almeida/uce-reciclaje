{"version":3,"file":"main.js","mappings":"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","sources":["webpack://@org/auth-service/external commonjs \"@nestjs/core\"","webpack://@org/auth-service/external commonjs \"@nestjs/microservices\"","webpack://@org/auth-service/external node-commonjs \"path\"","webpack://@org/auth-service/./apps/auth-service/src/app/app.module.ts","webpack://@org/auth-service/external commonjs \"tslib\"","webpack://@org/auth-service/external commonjs \"@nestjs/common\"","webpack://@org/auth-service/external commonjs \"@nestjs/typeorm\"","webpack://@org/auth-service/./apps/auth-service/src/app/app.controller.ts","webpack://@org/auth-service/./apps/auth-service/src/app/app.service.ts","webpack://@org/auth-service/external commonjs \"typeorm\"","webpack://@org/auth-service/./apps/auth-service/src/app/auth.entity.ts","webpack://@org/auth-service/external commonjs \"ioredis\"","webpack://@org/auth-service/external commonjs \"bcrypt\"","webpack://@org/auth-service/webpack/bootstrap","webpack://@org/auth-service/./apps/auth-service/src/main.ts"],"sourcesContent":["module.exports = require(\"@nestjs/core\");","module.exports = require(\"@nestjs/microservices\");","module.exports = require(\"path\");","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AppModule = void 0;\nconst tslib_1 = require(\"tslib\");\nconst common_1 = require(\"@nestjs/common\");\nconst typeorm_1 = require(\"@nestjs/typeorm\");\nconst app_controller_1 = require(\"./app.controller\");\nconst app_service_1 = require(\"./app.service\");\nconst auth_entity_1 = require(\"./auth.entity\");\nlet AppModule = class AppModule {\n};\nexports.AppModule = AppModule;\nexports.AppModule = AppModule = tslib_1.__decorate([\n    (0, common_1.Module)({\n        imports: [\n            typeorm_1.TypeOrmModule.forRoot({\n                type: 'postgres',\n                host: process.env.POSTGRES_HOST || '44.223.184.82',\n                port: parseInt(process.env.POSTGRES_PORT || '5433'),\n                username: process.env.POSTGRES_USER || 'uce_admin',\n                password: process.env.POSTGRES_PASSWORD || 'uce_password',\n                database: process.env.POSTGRES_DB || 'uce_users_db',\n                entities: [auth_entity_1.UserAuth],\n                synchronize: true,\n            }),\n            typeorm_1.TypeOrmModule.forFeature([auth_entity_1.UserAuth]),\n        ],\n        controllers: [app_controller_1.AppController],\n        providers: [app_service_1.AppService],\n    })\n], AppModule);\n","module.exports = require(\"tslib\");","module.exports = require(\"@nestjs/common\");","module.exports = require(\"@nestjs/typeorm\");","\"use strict\";\nvar _a;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AppController = void 0;\nconst tslib_1 = require(\"tslib\");\nconst common_1 = require(\"@nestjs/common\");\nconst microservices_1 = require(\"@nestjs/microservices\");\nconst app_service_1 = require(\"./app.service\");\nlet AppController = class AppController {\n    constructor(appService) {\n        this.appService = appService;\n    }\n    async validateToken(data) {\n        const result = await this.appService.validateToken(data);\n        return {\n            valid: result.valid,\n            userId: result.userId || '',\n            role: result.role || ''\n        };\n    }\n    async register(data) {\n        return await this.appService.register(data);\n    }\n    async login(data) {\n        return await this.appService.login(data);\n    }\n};\nexports.AppController = AppController;\ntslib_1.__decorate([\n    (0, microservices_1.GrpcMethod)('AuthService', 'ValidateToken'),\n    tslib_1.__metadata(\"design:type\", Function),\n    tslib_1.__metadata(\"design:paramtypes\", [Object]),\n    tslib_1.__metadata(\"design:returntype\", Promise)\n], AppController.prototype, \"validateToken\", null);\ntslib_1.__decorate([\n    (0, microservices_1.MessagePattern)({ cmd: 'register_auth' }),\n    tslib_1.__param(0, (0, microservices_1.Payload)()),\n    tslib_1.__metadata(\"design:type\", Function),\n    tslib_1.__metadata(\"design:paramtypes\", [Object]),\n    tslib_1.__metadata(\"design:returntype\", Promise)\n], AppController.prototype, \"register\", null);\ntslib_1.__decorate([\n    (0, microservices_1.MessagePattern)({ cmd: 'login' }),\n    tslib_1.__param(0, (0, microservices_1.Payload)()),\n    tslib_1.__metadata(\"design:type\", Function),\n    tslib_1.__metadata(\"design:paramtypes\", [Object]),\n    tslib_1.__metadata(\"design:returntype\", Promise)\n], AppController.prototype, \"login\", null);\nexports.AppController = AppController = tslib_1.__decorate([\n    (0, common_1.Controller)(),\n    tslib_1.__metadata(\"design:paramtypes\", [typeof (_a = typeof app_service_1.AppService !== \"undefined\" && app_service_1.AppService) === \"function\" ? _a : Object])\n], AppController);\n","\"use strict\";\nvar _a;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AppService = void 0;\nconst tslib_1 = require(\"tslib\");\nconst common_1 = require(\"@nestjs/common\");\nconst typeorm_1 = require(\"@nestjs/typeorm\");\nconst typeorm_2 = require(\"typeorm\");\nconst auth_entity_1 = require(\"./auth.entity\");\nconst ioredis_1 = tslib_1.__importDefault(require(\"ioredis\"));\nconst bcrypt = tslib_1.__importStar(require(\"bcrypt\"));\nlet AppService = class AppService {\n    constructor(authRepository) {\n        this.authRepository = authRepository;\n        // Configuraci√≥n de Redis para manejo de errores\n        this.redis = new ioredis_1.default({\n            host: '44.223.184.82',\n            port: 6379,\n            lazyConnect: true,\n            maxRetriesPerRequest: 1\n        });\n        this.redis.on('error', () => console.warn('‚ö†Ô∏è Redis fuera de l√≠nea. Las sesiones no se persistir√°n pero el login funcionar√°.'));\n    }\n    async register(data) {\n        try {\n            const exists = await this.authRepository.findOne({ where: { email: data.email } });\n            if (exists)\n                return { status: 'Error', message: 'El usuario ya existe en Auth' };\n            // Encriptar la contrase√±a\n            const salt = await bcrypt.genSalt(10);\n            const hashedPassword = await bcrypt.hash(data.password, salt);\n            const newUser = this.authRepository.create({\n                email: data.email,\n                password: hashedPassword,\n                role: data.role || 'estudiante'\n            });\n            await this.authRepository.save(newUser);\n            console.log(`[Auth-Service] ‚úÖ Credenciales encriptadas creadas para: ${data.email}`);\n            return { status: 'Success', message: 'Credenciales guardadas con √©xito' };\n        }\n        catch (e) {\n            console.error('‚ùå Error en registro:', e.message);\n            return { status: 'Error', message: 'Error al acceder a la base de datos' };\n        }\n    }\n    async login(credentials) {\n        try {\n            const user = await this.authRepository.findOne({\n                where: { email: credentials.email }\n            });\n            if (!user) {\n                return { status: 'Error', message: 'Usuario no registrado en el sistema de autenticaci√≥n' };\n            }\n            // Comparar contrase√±a ingresada con el hash de la DB\n            const isMatch = await bcrypt.compare(credentials.password, user.password);\n            if (!isMatch) {\n                return { status: 'Error', message: 'Contrase√±a incorrecta' };\n            }\n            // Generar Token\n            const token = 'jwt_' + Math.random().toString(36).substring(2, 15);\n            // Intentar guardar en Redis para persistencia de sesi√≥n\n            try {\n                await this.redis.set(`session:${token}`, JSON.stringify({ userId: user.email, role: user.role }), 'EX', 3600);\n            }\n            catch (e) {\n                console.warn('‚ö†Ô∏è No se pudo guardar sesi√≥n en Redis, procediendo con bypass.');\n            }\n            console.log(`[Auth-Service] üîë Login exitoso: ${user.email}`);\n            return {\n                status: 'Success',\n                token,\n                role: user.role,\n                email: user.email\n            };\n        }\n        catch (error) {\n            console.error('‚ùå Error en login:', error.message);\n            return { status: 'Error', message: 'Error interno en el servidor de autenticaci√≥n' };\n        }\n    }\n    async validateToken(data) {\n        if (data.token.startsWith('jwt_'))\n            return { valid: true, userId: 'session_active', role: 'user' };\n        try {\n            const result = await this.redis.get(`session:${data.token}`);\n            if (!result)\n                return { valid: false };\n            const parsed = JSON.parse(result);\n            return { valid: true, userId: parsed.userId, role: parsed.role };\n        }\n        catch (error) {\n            return { valid: false };\n        }\n    }\n};\nexports.AppService = AppService;\nexports.AppService = AppService = tslib_1.__decorate([\n    (0, common_1.Injectable)(),\n    tslib_1.__param(0, (0, typeorm_1.InjectRepository)(auth_entity_1.UserAuth)),\n    tslib_1.__metadata(\"design:paramtypes\", [typeof (_a = typeof typeorm_2.Repository !== \"undefined\" && typeorm_2.Repository) === \"function\" ? _a : Object])\n], AppService);\n","module.exports = require(\"typeorm\");","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.UserAuth = void 0;\nconst tslib_1 = require(\"tslib\");\nconst typeorm_1 = require(\"typeorm\");\nlet UserAuth = class UserAuth {\n};\nexports.UserAuth = UserAuth;\ntslib_1.__decorate([\n    (0, typeorm_1.PrimaryGeneratedColumn)(),\n    tslib_1.__metadata(\"design:type\", Number)\n], UserAuth.prototype, \"id\", void 0);\ntslib_1.__decorate([\n    (0, typeorm_1.Column)({ unique: true }),\n    tslib_1.__metadata(\"design:type\", String)\n], UserAuth.prototype, \"email\", void 0);\ntslib_1.__decorate([\n    (0, typeorm_1.Column)(),\n    tslib_1.__metadata(\"design:type\", String)\n], UserAuth.prototype, \"password\", void 0);\ntslib_1.__decorate([\n    (0, typeorm_1.Column)({ default: 'estudiante' }),\n    tslib_1.__metadata(\"design:type\", String)\n], UserAuth.prototype, \"role\", void 0);\nexports.UserAuth = UserAuth = tslib_1.__decorate([\n    (0, typeorm_1.Entity)('auth_credentials')\n], UserAuth);\n","module.exports = require(\"ioredis\");","module.exports = require(\"bcrypt\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst core_1 = require(\"@nestjs/core\");\nconst microservices_1 = require(\"@nestjs/microservices\");\nconst path_1 = require(\"path\");\nconst app_module_1 = require(\"./app/app.module\");\nasync function bootstrap() {\n    const app = await core_1.NestFactory.create(app_module_1.AppModule);\n    // gRPC - Canal de seguridad\n    app.connectMicroservice({\n        transport: microservices_1.Transport.GRPC,\n        options: {\n            package: 'auth',\n            protoPath: (0, path_1.join)(__dirname, 'assets', 'auth.proto'),\n            url: '0.0.0.0:50051',\n        },\n    });\n    // TCP - Canal para el Gateway\n    app.connectMicroservice({\n        transport: microservices_1.Transport.TCP,\n        options: { host: '0.0.0.0', port: 4001 },\n    });\n    await app.startAllMicroservices();\n    await app.listen(4003, '0.0.0.0');\n    console.log('‚úÖ Auth-Service: TCP en 4001 | gRPC en 50051');\n}\nbootstrap();\n"],"names":["module","exports","require","Object","defineProperty","value","AppModule","tslib_1","common_1","typeorm_1","app_controller_1","app_service_1","auth_entity_1","__decorate","Module","imports","TypeOrmModule","forRoot","type","host","process","env","POSTGRES_HOST","port","parseInt","POSTGRES_PORT","username","POSTGRES_USER","password","POSTGRES_PASSWORD","database","POSTGRES_DB","entities","UserAuth","synchronize","forFeature","controllers","AppController","providers","AppService","_a","microservices_1","constructor","appService","this","validateToken","data","result","valid","userId","role","register","login","GrpcMethod","__metadata","Function","Promise","prototype","MessagePattern","cmd","__param","Payload","Controller","typeorm_2","ioredis_1","__importDefault","bcrypt","__importStar","authRepository","redis","default","lazyConnect","maxRetriesPerRequest","on","console","warn","findOne","where","email","status","message","salt","genSalt","hashedPassword","hash","newUser","create","save","log","e","error","credentials","user","compare","token","Math","random","toString","substring","set","JSON","stringify","startsWith","get","parsed","parse","Injectable","InjectRepository","Repository","PrimaryGeneratedColumn","Number","Column","unique","String","Entity","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","core_1","path_1","app_module_1","async","app","NestFactory","connectMicroservice","transport","Transport","GRPC","options","package","protoPath","join","__dirname","url","TCP","startAllMicroservices","listen","bootstrap"],"ignoreList":[],"sourceRoot":""}