{"version":3,"file":"main.js","mappings":";;;;;;;AAAA,2C;;;;;;ACAA,yC;;;;;;ACAA,kD;;;;;;ACAa;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,iBAAiB;AACjB,gBAAgB,mBAAO,CAAC,CAAO;AAC/B,iBAAiB,mBAAO,CAAC,CAAgB;AACzC,mBAAmB,mBAAO,CAAC,CAAkB,GAAG;AAChD,yBAAyB,mBAAO,CAAC,CAAkB;AACnD,sBAAsB,mBAAO,CAAC,CAAe;AAC7C,uBAAuB,mBAAO,CAAC,EAAgB;AAC/C;AACA;AACA,iBAAiB;AACjB,iBAAiB;AACjB;AACA;AACA;AACA;AACA;AACA,oDAAoD,qEAAqE;AACzH;AACA;AACA;AACA,KAAK;AACL;;;;;;;ACvBA,kC;;;;;;ACAA,6C;;;;;;ACAa;AACb;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,qBAAqB;AACrB,gBAAgB,mBAAO,CAAC,CAAO;AAC/B,iBAAiB,mBAAO,CAAC,CAAgB;AACzC,wBAAwB,mBAAO,CAAC,CAAuB;AACvD,sBAAsB,mBAAO,CAAC,CAAe;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,qBAAqB;AACrB;AACA;AACA;;;;;;;AC7Ba;AACb;AACA;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,kBAAkB;AAClB,gBAAgB,mBAAO,CAAC,CAAO;AAC/B,iBAAiB,mBAAO,CAAC,CAAgB;AACzC,mBAAmB,mBAAO,CAAC,CAAkB;AAC7C,mBAAmB,mBAAO,CAAC,CAAU;AACrC,uBAAuB,mBAAO,CAAC,EAAgB;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iFAAiF,YAAY;AAC7F;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;AACA,+DAA+D,cAAc;AAC7E;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kBAAkB;AAClB,kBAAkB;AAClB;AACA;AACA;AACA;;;;;;;AC1CA,qC;;;;;;ACAa;AACb;AACA,8CAA6C,EAAE,aAAa,EAAC;AAC7D,mBAAmB,GAAG,aAAa;AACnC,gBAAgB,mBAAO,CAAC,CAAO;AAC/B,mBAAmB,mBAAO,CAAC,CAAkB;AAC7C,mBAAmB,mBAAO,CAAC,CAAU;AACrC;AACA;AACA,aAAa;AACb;AACA,2BAA2B,8BAA8B;AACzD;AACA;AACA;AACA;AACA,2BAA2B,8BAA8B;AACzD;AACA;AACA;AACA;AACA,2BAA2B,+BAA+B;AAC1D;AACA;AACA;AACA,aAAa;AACb,6BAA6B,kBAAkB;AAC/C;AACA,mBAAmB;;;;;;UC5BnB;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;;;ACtBa;AACb,8CAA6C,EAAE,aAAa,EAAC;AAC7D,iBAAiB,mBAAO,CAAC,CAAgB;AACzC,eAAe,mBAAO,CAAC,CAAc;AACrC,wBAAwB,mBAAO,CAAC,CAAuB;AACvD,qBAAqB,mBAAO,CAAC,CAAkB;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,KAAK;AACL;AACA;AACA;AACA","sources":["external commonjs \"@nestjs/common\"","external commonjs \"@nestjs/core\"","external commonjs \"@nestjs/microservices\"","C:\\Users\\IntelCore i5\\uce-reciclaje\\apps\\audit-service\\src\\app\\app.module.ts","external commonjs \"tslib\"","external commonjs \"@nestjs/mongoose\"","C:\\Users\\IntelCore i5\\uce-reciclaje\\apps\\audit-service\\src\\app\\app.controller.ts","C:\\Users\\IntelCore i5\\uce-reciclaje\\apps\\audit-service\\src\\app\\app.service.ts","external commonjs \"mongoose\"","C:\\Users\\IntelCore i5\\uce-reciclaje\\apps\\audit-service\\src\\app\\audit.schema.ts","webpack/bootstrap","C:\\Users\\IntelCore i5\\uce-reciclaje\\apps\\audit-service\\src\\main.ts"],"sourcesContent":["module.exports = require(\"@nestjs/common\");","module.exports = require(\"@nestjs/core\");","module.exports = require(\"@nestjs/microservices\");","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AppModule = void 0;\nconst tslib_1 = require(\"tslib\");\nconst common_1 = require(\"@nestjs/common\");\nconst mongoose_1 = require(\"@nestjs/mongoose\"); // MongoDB, no Redis\nconst app_controller_1 = require(\"./app.controller\");\nconst app_service_1 = require(\"./app.service\");\nconst audit_schema_1 = require(\"./audit.schema\");\nlet AppModule = class AppModule {\n};\nexports.AppModule = AppModule;\nexports.AppModule = AppModule = tslib_1.__decorate([\n    (0, common_1.Module)({\n        imports: [\n            // MongoDB para Auditor√≠a\n            // Usamos el bridge de Docker para conectar con el contenedor de Mongo en la misma instancia\n            mongoose_1.MongooseModule.forRoot(process.env.MONGO_URI || 'mongodb://172.17.0.1:27017/uce_audit_db'),\n            mongoose_1.MongooseModule.forFeature([{ name: audit_schema_1.Audit.name, schema: audit_schema_1.AuditSchema }]),\n        ],\n        controllers: [app_controller_1.AppController],\n        providers: [app_service_1.AppService],\n    })\n], AppModule);\n","module.exports = require(\"tslib\");","module.exports = require(\"@nestjs/mongoose\");","\"use strict\";\nvar _a;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AppController = void 0;\nconst tslib_1 = require(\"tslib\");\nconst common_1 = require(\"@nestjs/common\");\nconst microservices_1 = require(\"@nestjs/microservices\");\nconst app_service_1 = require(\"./app.service\");\nlet AppController = class AppController {\n    constructor(appService) {\n        this.appService = appService;\n    }\n    // Escucha al Kafa\n    async manejarEventoAuditoria(data) {\n        const payload = typeof data === 'string' ? JSON.parse(data) : data;\n        return await this.appService.crearLog(payload);\n    }\n};\nexports.AppController = AppController;\ntslib_1.__decorate([\n    (0, microservices_1.EventPattern)('uce.reciclaje.botella_depositada'),\n    tslib_1.__param(0, (0, microservices_1.Payload)()),\n    tslib_1.__metadata(\"design:type\", Function),\n    tslib_1.__metadata(\"design:paramtypes\", [Object]),\n    tslib_1.__metadata(\"design:returntype\", Promise)\n], AppController.prototype, \"manejarEventoAuditoria\", null);\nexports.AppController = AppController = tslib_1.__decorate([\n    (0, common_1.Controller)(),\n    tslib_1.__metadata(\"design:paramtypes\", [typeof (_a = typeof app_service_1.AppService !== \"undefined\" && app_service_1.AppService) === \"function\" ? _a : Object])\n], AppController);\n","\"use strict\";\nvar AppService_1;\nvar _a;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AppService = void 0;\nconst tslib_1 = require(\"tslib\");\nconst common_1 = require(\"@nestjs/common\");\nconst mongoose_1 = require(\"@nestjs/mongoose\");\nconst mongoose_2 = require(\"mongoose\");\nconst audit_schema_1 = require(\"./audit.schema\");\nlet AppService = AppService_1 = class AppService {\n    constructor(auditModel) {\n        this.auditModel = auditModel;\n        this.logger = new common_1.Logger(AppService_1.name);\n    }\n    async crearLog(data) {\n        try {\n            this.logger.log(`[QA] Intentando registrar auditor√≠a para usuario: ${data.userId}`);\n            const nuevoLog = new this.auditModel({\n                accion: 'DEPOSITO_BOTELLA',\n                usuarioId: data.userId || 'ANONIMO',\n                detalles: {\n                    peso: data.peso,\n                    puntosAsignados: data.puntos,\n                    fechaOriginal: data.fecha\n                }\n            });\n            const resultado = await nuevoLog.save();\n            this.logger.log(`[DB Mongo] Log guardado con ID: ${resultado._id}`);\n            return resultado;\n        }\n        catch (error) {\n            this.logger.error('Error al conectar o guardar en MongoDB', error.stack);\n            throw error;\n        }\n    }\n};\nexports.AppService = AppService;\nexports.AppService = AppService = AppService_1 = tslib_1.__decorate([\n    (0, common_1.Injectable)(),\n    tslib_1.__param(0, (0, mongoose_1.InjectModel)(audit_schema_1.Audit.name)),\n    tslib_1.__metadata(\"design:paramtypes\", [typeof (_a = typeof mongoose_2.Model !== \"undefined\" && mongoose_2.Model) === \"function\" ? _a : Object])\n], AppService);\n","module.exports = require(\"mongoose\");","\"use strict\";\nvar _a;\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.AuditSchema = exports.Audit = void 0;\nconst tslib_1 = require(\"tslib\");\nconst mongoose_1 = require(\"@nestjs/mongoose\");\nconst mongoose_2 = require(\"mongoose\");\nlet Audit = class Audit extends mongoose_2.Document {\n};\nexports.Audit = Audit;\ntslib_1.__decorate([\n    (0, mongoose_1.Prop)({ type: String, required: true }) // <-- Agrega el tipo aqu√≠\n    ,\n    tslib_1.__metadata(\"design:type\", String)\n], Audit.prototype, \"accion\", void 0);\ntslib_1.__decorate([\n    (0, mongoose_1.Prop)({ type: String, required: true }) // <-- Agrega el tipo aqu√≠\n    ,\n    tslib_1.__metadata(\"design:type\", String)\n], Audit.prototype, \"usuarioId\", void 0);\ntslib_1.__decorate([\n    (0, mongoose_1.Prop)({ type: Date, default: Date.now }) // <-- Esto tambi√©n ayuda\n    ,\n    tslib_1.__metadata(\"design:type\", typeof (_a = typeof Date !== \"undefined\" && Date) === \"function\" ? _a : Object)\n], Audit.prototype, \"fecha\", void 0);\nexports.Audit = Audit = tslib_1.__decorate([\n    (0, mongoose_1.Schema)({ timestamps: true }) // REQUISITO 6: Registro de fecha y hora\n], Audit);\nexports.AuditSchema = mongoose_1.SchemaFactory.createForClass(Audit);\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst common_1 = require(\"@nestjs/common\");\nconst core_1 = require(\"@nestjs/core\");\nconst microservices_1 = require(\"@nestjs/microservices\");\nconst app_module_1 = require(\"./app/app.module\");\nasync function bootstrap() {\n    // Lo creamos como microservicio TCP para que el Gateway lo vea en el 3008\n    const app = await core_1.NestFactory.createMicroservice(app_module_1.AppModule, {\n        transport: microservices_1.Transport.TCP,\n        options: {\n            host: '0.0.0.0', // Importante para AWS\n            port: 3008,\n        },\n    });\n    await app.listen();\n    common_1.Logger.log('üöÄ Audit-Service (Solo Mongo) listo en puerto TCP 3008');\n}\nbootstrap();\n"],"names":[],"ignoreList":[],"sourceRoot":""}